{"version":3,"sources":["webpack:///./src/views/client/Me.vue?7754","webpack:///./src/views/client/Me.vue?465a","webpack:///./src/utils/botkit.ts","webpack:///./src/views/client/Me.vue?5ba8","webpack:///./src/views/client/Me.vue?e185","webpack:///./src/views/client/Me.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","class","prefixCls","_v","_m","_l","item","index","key","style","textAlign","type","attrs","options","domProps","_s","text","actionItem","title","on","$event","actionClick","_e","content","staticRenderFns","maxReconnect","reconnectCount","reconnectTimeout","connectEvent","socket","WebSocket","wsUrl","monitor","message","user","UUID","channel","send","JSON","stringify","removeEventListener","open","bind","onMessage","onError","reconnect","close","addEventListener","event","user_profile","onOpen","setTimeout","BotkitHelper","instance","onClose","botkitUUID","UUIDStore","i","len","undefined","discuss","parse","data","discussOptions","push","$set","length","e","console","error","getInstance","discussBotkit","payload","botkit","name","components","Markdown","component"],"mappings":"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","file":"js/chunk-03cc9882.6c37addc.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Me.vue?vue&type=style&index=0&id=02f35bf7&lang=stylus&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Me.vue?vue&type=style&index=0&id=02f35bf7&lang=stylus&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('main',{class:[_vm.prefixCls + '-wrap']},[_c('div',{class:[_vm.prefixCls + '-discuss']},[_c('div',{class:[_vm.prefixCls + '-discuss-title']},[_vm._v(\"与\"),_vm._m(0),_vm._v(\"对话中...\")]),_c('div',{class:[_vm.prefixCls + '-discuss-message-wrap']},_vm._l((_vm.discuss),function(item,index){return _c('div',{key:index,class:[_vm.prefixCls + '-discuss-message-container'],style:({ textAlign: item.type === 'message' ? 'left' : 'right' })},[_c('div',{class:[_vm.prefixCls + '-discuss-message', _vm.prefixCls + '-' + item.type],attrs:{\"data-action\":!!item.options},domProps:{\"innerHTML\":_vm._s(item.text)}}),(item.options)?_c('div',{class:[_vm.prefixCls + '-action-container']},_vm._l((item.options),function(actionItem){return _c('button',{key:actionItem.title,class:[_vm.prefixCls + '-action-button'],on:{\"click\":function($event){return _vm.actionClick(index, actionItem)}}},[_vm._v(_vm._s(actionItem.title))])}),0):_vm._e()])}),0)]),_c('Markdown',{attrs:{\"content\":_vm.content}})],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ruby',[_vm._v(\"凌寒初见\"),_c('rt',[_vm._v(\"こんにちは\")])])}]\n\nexport { render, staticRenderFns }","// 凌寒初见 机器人\r\nimport { Botkit, BotkitMessage, BotkitOptions } from '@/types/utils'\r\nimport { addStore, getStore, randomCharacter } from '@/utils'\r\n\r\n\r\nexport default class BotkitHelper implements Botkit {\r\n    public static instance?: BotkitHelper\r\n    public static getInstance(options: BotkitOptions): BotkitHelper {\r\n        if (!this.instance) {\r\n            this.instance = new BotkitHelper(options)\r\n        }\r\n        return this.instance\r\n    }\r\n\r\n    public static isSocket(): boolean {\r\n        return typeof WebSocket !== undefined\r\n    }\r\n\r\n    private socket: WebSocket\r\n    private options: BotkitOptions\r\n    private maxReconnect: number = 3\r\n    private reconnectCount: number = 0\r\n    private reconnectTimeout: number = 3000\r\n    private connectEvent: string = 'welcome_back'\r\n\r\n    constructor(options: BotkitOptions) {\r\n        this.options = options\r\n        this.socket = new WebSocket(options.wsUrl)\r\n        this.monitor()\r\n    }\r\n\r\n    public getSocket(): WebSocket {\r\n        return this.socket\r\n    }\r\n\r\n    public send(text: string | BotkitMessage): void {\r\n        const message: BotkitMessage = typeof text === 'object' ? text : { type: 'message', text, user: this.UUID, channel: 'socket' }\r\n        this.socket.send(JSON.stringify(message))\r\n    }\r\n\r\n    public close(): void {\r\n        this.socket.removeEventListener('open', this.open.bind(this))\r\n        this.socket.removeEventListener('message', this.options.onMessage)\r\n        this.socket.removeEventListener('error', this.options.onError)\r\n        this.socket.removeEventListener('close', this.reconnect.bind(this))\r\n        this.socket.close()\r\n    }\r\n\r\n    private monitor(): void {\r\n        this.socket.addEventListener('open', this.open.bind(this))\r\n        this.socket.addEventListener('message', this.options.onMessage)\r\n        this.socket.addEventListener('error', this.options.onError)\r\n        this.socket.addEventListener('close', this.reconnect.bind(this))\r\n    }\r\n\r\n    private open(event: Event) {\r\n        this.reconnectCount = 0\r\n        const message: BotkitMessage = {\r\n            type: this.connectEvent,\r\n            channel: 'socket',\r\n            user: this.UUID,\r\n            user_profile: null,\r\n        }\r\n        this.send(message)\r\n        if (this.options.onOpen) { this.options.onOpen(event) }\r\n    }\r\n\r\n    // 重新连接\r\n    private reconnect(event: CloseEvent) {\r\n        if (this.reconnectCount < this.maxReconnect) {\r\n            setTimeout(() => {\r\n                this.reconnectCount += 1\r\n                BotkitHelper.instance = new BotkitHelper(this.options)\r\n            }, this.reconnectTimeout)\r\n        }\r\n        if (this.options.onClose) { this.options.onClose(event) }\r\n    }\r\n\r\n    private get UUID(): string {\r\n        let botkitUUID: string = ''\r\n        const UUIDStore: string | null = getStore('botkit-uuid')\r\n\r\n        if (!UUIDStore) {\r\n            botkitUUID += randomCharacter()\r\n            for (let i = 0, len = 4; i < len; i++) {\r\n                botkitUUID += `${randomCharacter()}-${randomCharacter()}`\r\n            }\r\n            botkitUUID += randomCharacter()\r\n            addStore('botkit-uuid', botkitUUID)\r\n\r\n            this.connectEvent = 'hello'\r\n        }\r\n\r\n        return UUIDStore ? UUIDStore : botkitUUID\r\n    }\r\n}\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Botkit from '@/utils/botkit'\r\nimport Markdown from '@/components/Markdown.vue'\r\nimport { Component, Prop, Vue } from 'vue-property-decorator'\r\nimport { BotkitOptions, UserDiscuss, QuickReplies } from '@/types/utils'\r\n\r\n\r\n@Component({\r\n    name: 'Me',\r\n    components: {\r\n        Markdown,\r\n    },\r\n})\r\nexport default class Me extends Vue {\r\n    private prefixCls: string = 'me'\r\n\r\n    private discussBotkit: Botkit | undefined\r\n\r\n    private discuss: UserDiscuss[] = []\r\n\r\n    private content: string = '<p><em>2018/11/6 接入 Google AdSense；<br> 2018/6/6 博客 Android <a href=\"https://2heng.xin/client/\">客户端</a>上线；<br> 2018/5/24 网页使用了思源宋体，即时加载中文字体有一定网速压力，可选择本地安装<a href=\"https://cloud.moezx.cc/Fonts/思源宋体【开源】/\" target=\"_blank\" rel=\"nofollow\">思源宋体</a>；<br> 2018/4/25 <a href=\"https://mashiro.top/\" target=\"_blank\" rel=\"nofollow\">笔记本</a>改用 Hexo — Simple is the best；<br> 2017/11/26 起使用新主题 <a href=\"https://2heng.xin/theme-sakura/\">Sakura</a>；<br> 2017/8/9 - 2017/11/26 使用的主题 <a href=\"https://github.com/moezx/Moezx-WP-theme\" target=\"_blank\" rel=\"nofollow\">Moezx</a>；<br> 2017/8/9 博客由 Jeklly 平台迁移至 WordPress。</em></p>'\r\n\r\n    private botkit(): Botkit {\r\n        const options: BotkitOptions = {\r\n            wsUrl: process.env.VUE_APP_SOCKRT_BOTKIT_URL,\r\n            onMessage: (event: MessageEvent) => {\r\n                try {\r\n                    const message: UserDiscuss = JSON.parse(event.data)\r\n                    const discussOptions: QuickReplies[] | undefined = message.options\r\n                    delete message.options\r\n                    this.discuss.push(message)\r\n                    if (options) { setTimeout(() => this.$set(this.discuss[this.discuss.length - 1], 'options', discussOptions), 1000) }\r\n                } catch (e) {\r\n                    console.error(e)\r\n                }\r\n            },\r\n            onError: (event: Event) => {\r\n                console.error(event)\r\n            },\r\n        }\r\n        return Botkit.getInstance(options)\r\n    }\r\n\r\n    private actionClick(index: number, item: QuickReplies): void {\r\n        this.$set(this.discuss[index], 'options', undefined)\r\n        this.discuss.push({ type: 'wanderer-message', text: item.title })\r\n        if (this.discussBotkit) { this.discussBotkit.send(item.payload) }\r\n    }\r\n\r\n    private mounted(): void {\r\n        this.discussBotkit = this.botkit()\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--13-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Me.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--13-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Me.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Me.vue?vue&type=template&id=02f35bf7&scoped=true&lang=pug&\"\nimport script from \"./Me.vue?vue&type=script&lang=ts&\"\nexport * from \"./Me.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Me.vue?vue&type=style&index=0&id=02f35bf7&lang=stylus&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"02f35bf7\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}